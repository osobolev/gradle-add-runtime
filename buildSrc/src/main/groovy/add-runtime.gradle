plugins {
    id "lib"
}

configurations.testRuntimeClasspath {
    resolutionStrategy.dependencySubstitution {
        all {
            if (it.requested instanceof ProjectComponentSelector) {
                def refProject = findProject(it.requested.projectPath)
                if (refProject.plugins.findPlugin("api-lib") != null) {
                    it.useTarget variant(it.requested) {
                        capabilities {
                            requireCapability("${refProject.group}:${refProject.name}-add-impl")
                        }
                    }
                }
            }
        }
    }
}
